<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Fraction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">reciprocal</a> &gt; <a href="index.source.html" class="el_package">reciprocal.number.fraction</a> &gt; <span class="el_source">Fraction.java</span></div><h1>Fraction.java</h1><pre class="source lang-java linenums">package reciprocal.number.fraction;

import static com.google.common.base.Preconditions.checkArgument;
import static java.util.Objects.requireNonNull;

import com.google.common.math.LongMath;
import java.io.Serial;
import java.io.Serializable;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.math.MathContext;
import java.util.Comparator;
import java.util.function.BiFunction;
import java.util.stream.Stream;
import org.jetbrains.annotations.NotNull;

/**
 * Immutable implementation of a fraction that uses {@link Long} as type for
 * its numerator and denominator
 * &lt;p&gt;
 * The returned Fractions of most methods are neither normalized nor reduced.
 *
 * @since 0.0.1
 */
public final class Fraction extends AbstractFraction&lt;@NotNull Long, @NotNull Fraction, @NotNull Double&gt; {
    /**
     * 0
     *
     * @since 0.0.1
     */
<span class="fc" id="L31">    public static final @NotNull Fraction ZERO = ofNumerator(0L);</span>

    /**
     * 1
     *
     * @since 0.0.1
     */
<span class="fc" id="L38">    public static final @NotNull Fraction ONE = ofNumerator(1L);</span>

    /**
     * Units
     *
     * @since 0.0.1
     */
<span class="pc" id="L45">    public static final Stream&lt;Fraction&gt; UNITS = Stream.iterate(ONE, f -&gt; ofDenominator(f.getDenominator() + 1L));</span>

    @Serial
    private static final long serialVersionUID = 1L;

    /**
     * Constructor
     *
     * @param numerator numerator
     * @param denominator denominator
     * @throws IllegalArgumentException when {@code denominator == 0}
     * @since 0.0.1
     */
    public Fraction(final long numerator, final long denominator) {
<span class="fc" id="L59">        super(numerator, denominator);</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">        checkArgument(denominator != 0L, &quot;denominator != 0 expected but denominator = %s&quot;, denominator);</span>
<span class="fc" id="L61">    }</span>

    /**
     * Static factory method
     *
     * @param numerator numerator
     * @return numerator / 1
     * @since 0.0.1
     */
    public static @NotNull Fraction ofNumerator(final long numerator) {
<span class="fc" id="L71">        return new Fraction(numerator, 1L);</span>
    }

    /**
     * Static factory method
     *
     * @param denominator denominator
     * @return 1 / denominator
     * @since 0.0.1
     */
    public static @NotNull Fraction ofDenominator(final long denominator) {
<span class="fc" id="L82">        return new Fraction(1L, denominator);</span>
    }

    @Override
    public boolean isInvertible() {
<span class="fc bfc" id="L87" title="All 2 branches covered.">        return getNumerator() != 0L;</span>
    }

    @Override
    public boolean isUnit() {
<span class="fc bfc" id="L92" title="All 2 branches covered.">        return getNumerator() == 1L;</span>
    }

    @Override
    public boolean isDyadic() {
<span class="fc" id="L97">        return LongMath.isPowerOfTwo(getDenominator());</span>
    }

    @Override
    public boolean isIrreducible() {
<span class="fc bfc" id="L102" title="All 2 branches covered.">        return LongMath.gcd(Math.abs(getNumerator()), Math.abs(getDenominator())) == 1L;</span>
    }

    @Override
    public boolean isProper() {
<span class="fc bfc" id="L107" title="All 2 branches covered.">        return Math.abs(getNumerator()) &lt; Math.abs(getDenominator());</span>
    }

    @Override
    public int getSignum() {
<span class="fc" id="L112">        final var numeratorCompareToZero = getNumerator().compareTo(0L);</span>
<span class="fc bfc" id="L113" title="All 2 branches covered.">        if (numeratorCompareToZero == 0) {</span>
<span class="fc" id="L114">            return 0;</span>
        }
<span class="fc bfc" id="L116" title="All 2 branches covered.">        return numeratorCompareToZero == getDenominator().compareTo(0L) ? 1 : -1;</span>
    }

    @Override
    public @NotNull Fraction add(final @NotNull Fraction summand) {
<span class="fc" id="L121">        requireNonNull(summand, &quot;summand&quot;);</span>
<span class="fc" id="L122">        final var num = summand.getDenominator() * getNumerator() + getDenominator() * summand.getNumerator();</span>
<span class="fc" id="L123">        final var den = getDenominator() * summand.getDenominator();</span>
<span class="fc" id="L124">        return new Fraction(num, den);</span>
    }

    @Override
    public @NotNull Fraction subtract(final @NotNull Fraction subtrahend) {
<span class="fc" id="L129">        requireNonNull(subtrahend, &quot;subtrahend&quot;);</span>
<span class="fc" id="L130">        final var num = subtrahend.getDenominator() * getNumerator() - getDenominator() * subtrahend.getNumerator();</span>
<span class="fc" id="L131">        final var den = getDenominator() * subtrahend.getDenominator();</span>
<span class="fc" id="L132">        return new Fraction(num, den);</span>
    }

    @Override
    public @NotNull Fraction multiply(final @NotNull Fraction factor) {
<span class="fc" id="L137">        requireNonNull(factor, &quot;factor&quot;);</span>
<span class="fc" id="L138">        return new Fraction(getNumerator() * factor.getNumerator(), getDenominator() * factor.getDenominator());</span>
    }

    @Override
    public @NotNull Fraction negate() {
<span class="fc" id="L143">        return new Fraction(-getNumerator(), getDenominator());</span>
    }

    @Override
    public @NotNull Fraction abs() {
<span class="fc" id="L148">        return new Fraction(Math.abs(getNumerator()), Math.abs(getDenominator()));</span>
    }

    @Override
    public @NotNull Fraction expand(final @NotNull Long number) {
<span class="fc" id="L153">        requireNonNull(number, &quot;number&quot;);</span>
<span class="fc" id="L154">        return new Fraction(number * getNumerator(), number * getDenominator());</span>
    }

    @Override
    public boolean lessThanOrEqualTo(final @NotNull Fraction other) {
<span class="fc" id="L159">        requireNonNull(other, &quot;other&quot;);</span>
<span class="fc" id="L160">        final var normalized = normalize();</span>
<span class="fc" id="L161">        final var normalizedOther = other.normalize();</span>
<span class="fc" id="L162">        final var left = normalizedOther.getDenominator() * normalized.getNumerator();</span>
<span class="fc" id="L163">        final var right = normalized.getDenominator() * normalizedOther.getNumerator();</span>
<span class="fc bfc" id="L164" title="All 2 branches covered.">        return left &lt;= right;</span>
    }

    @Override
    public @NotNull Fraction normalize() {
<span class="fc bfc" id="L169" title="All 4 branches covered.">        if (getSignum() &lt; 0 &amp;&amp; getNumerator().compareTo(0L) &gt; 0) {</span>
<span class="fc" id="L170">            return new Fraction(-getNumerator(), Math.abs(getDenominator()));</span>
        }
<span class="fc bfc" id="L172" title="All 2 branches covered.">        if (getSignum() &lt; 0) {</span>
<span class="fc" id="L173">            return this;</span>
        }
<span class="fc bfc" id="L175" title="All 2 branches covered.">        if (getSignum() == 0) {</span>
<span class="fc" id="L176">            return ZERO;</span>
        }
<span class="fc" id="L178">        return abs();</span>
    }

    @Override
    public @NotNull Fraction reduce() {
<span class="fc" id="L183">        final var gcd = LongMath.gcd(Math.abs(getNumerator()), Math.abs(getDenominator()));</span>
<span class="fc" id="L184">        return new Fraction(getNumerator() / gcd, getDenominator() / gcd);</span>
    }

    @Override
    public @NotNull BigDecimal toBigDecimal() {
<span class="fc" id="L189">        return BigDecimal.valueOf(getNumerator()).divide(BigDecimal.valueOf(getDenominator()), MathContext.DECIMAL128);</span>
    }

    /**
     * Returns this as {@link BigFraction}
     *
     * @return {@link BigFraction}
     */
    public @NotNull BigFraction toBigFraction() {
<span class="fc" id="L198">        return new BigFraction(BigInteger.valueOf(getNumerator()), BigInteger.valueOf(getDenominator()));</span>
    }

    @Override
    protected @NotNull Fraction getOne() {
<span class="fc" id="L203">        return ONE;</span>
    }

    @Override
    protected @NotNull BiFunction&lt;@NotNull Long, @NotNull Long, @NotNull Fraction&gt; getConstructor() {
<span class="fc" id="L208">        return Fraction::new;</span>
    }

    @Override
    public int compareTo(final @NotNull Fraction o) {
<span class="fc" id="L213">        return FractionComparator.INSTANCE.compare(this, o);</span>
    }

    /**
     * Comparator
     *
     * @since 0.0.1
     */
    public static final class FractionComparator implements Comparator&lt;Fraction&gt;, Serializable {
        /**
         * Instance
         *
         * @since 0.0.1
         */
<span class="fc" id="L227">        public static final FractionComparator INSTANCE = new FractionComparator();</span>

        @Serial
        private static final long serialVersionUID = 1L;

        private FractionComparator() {
        }

        @Override
        public int compare(final @NotNull Fraction o1, final @NotNull Fraction o2) {
<span class="fc" id="L237">            requireNonNull(o1, &quot;o1&quot;);</span>
<span class="fc" id="L238">            requireNonNull(o2, &quot;o2&quot;);</span>
<span class="fc bfc" id="L239" title="All 2 branches covered.">            if (o1.lessThan(o2)) {</span>
<span class="fc" id="L240">                return -1;</span>
            }
<span class="fc bfc" id="L242" title="All 2 branches covered.">            if (o1.greaterThan(o2)) {</span>
<span class="fc" id="L243">                return 1;</span>
            }
<span class="fc" id="L245">            return 0;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>